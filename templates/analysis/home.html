{% extends 'base.html' %}

{% block title %}Home - Chess Analysis{% endblock %}

{% block content %}
{% if user.is_authenticated %}
    <div class="home-top-row">
        <div class="account-status-column">
            <div class="section">
                <h3>Account Status</h3>

                <!-- Lichess Status -->
                {% if user.userprofile.lichess_username %}
                    <div class="status-indicator connected">
                        <p><strong>✅ Lichess Connected:</strong> {{ user.userprofile.lichess_username }}</p>
                    </div>
                {% else %}
                    <div class="status-indicator not-connected">
                        <p><strong>⚠️ Lichess Not Connected</strong></p>
                        <p>Connect your Lichess account to start analyzing your games.</p>
                    </div>
                {% endif %}

                <!-- Chess.com Status -->
                {% if user.userprofile.chess_com_username %}
                    <div class="status-indicator connected">
                        <p><strong>✅ Chess.com Connected:</strong> {{ user.userprofile.chess_com_username }}</p>
                    </div>
                {% else %}
                    <div class="status-indicator not-connected">
                        <p><strong>⚠️ Chess.com Not Connected</strong></p>
                        <a href="{% url 'analysis:chess_com_connect' %}" class="chess-com-connect-btn">Connect Chess.com</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="generate-button-column">
            <a href="{% url 'analysis:lichess_login' %}" class="lichess-button">
                {% load static %}
                <img src="{% static 'images/lichess_logo.svg' %}" alt="Lichess" class="lichess-logo">
                {% if user.userprofile.lichess_username %}Generate Lichess Report{% else %}Connect Lichess Account{% endif %}
            </a>

            {% if user.userprofile.chess_com_username %}
            <a href="{% url 'analysis:chess_com_analysis' user.userprofile.chess_com_username %}" class="chess-com-button">
                <img src="{% static 'images/chess_com_logo.png' %}" alt="Chess.com" class="chess-com-logo">
                Generate Chess.com Report
            </a>
            {% endif %}
        </div>
    </div>

    {% if reports %}
        <div class="section">
            <div class="reports-page-header">
                <h3>Recent Reports</h3>
                <a href="{% url 'analysis:user_reports' %}" class="btn btn-secondary">View All Reports</a>
            </div>
            <p>Your latest analysis reports:</p>

            {% for report in reports %}
            <a href="{% url 'analysis:view_report' report.id %}" class="report-card">
                <div class="report-stats-inline">
                    <div>
                        <strong>{{ report.game_dataset.lichess_username }}</strong>
                        <span class="report-card-platform">{{ report.platform }}</span>
                    </div>
                    <div>
                        <strong>{{ report.total_games }} Games</strong>
                    </div>
                    <div>
                        {{ report.created_at|date:"M j, Y" }}
                    </div>
                </div>
            </a>
            {% endfor %}

            <div class="view-all-reports-container">
                <a href="{% url 'analysis:user_reports' %}" class="btn btn-secondary">View All Reports</a>
            </div>
        </div>
    {% elif user.userprofile.lichess_username %}
        <div class="section">
            <h3>Ready to Start!</h3>
            <div class="empty-state">
                <p>Your Lichess account is connected. Click the button above to generate your first analysis report!</p>
            </div>
        </div>
    {% endif %}
{% else %}
    <div class="section">
        <h3>Get Started</h3>
        <p>Create an account or login to start analyzing your chess games!</p>
        <a href="/auth/login/" class="btn">Login</a>
        <a href="/auth/signup/" class="btn btn-secondary">Sign Up</a>
    </div>
{% endif %}

<h3>How it works:</h3>
<ol>
    <li>Create an account and connect your Lichess account</li>
    <li>We'll fetch your recent games (up to 5,000)</li>
    <li>Our analysis engine will process your games with Stockfish</li>
    <li>Get a comprehensive report with insights and recommendations</li>
</ol>
{% endblock %}
