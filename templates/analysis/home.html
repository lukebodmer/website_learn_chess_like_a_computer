{% extends 'base.html' %}
{% load static %}

{% block title %}Home - Chess Analysis{% endblock %}

{% block content %}

{% if user.is_authenticated %}
    <div class="home-cards-grid">
        <div class="section">
            <h3>Account Status</h3>

            <!-- Lichess Status -->
            {% if user.userprofile.lichess_username %}
                <div class="status-indicator connected lichess-status">
                    <p><strong>✅ Lichess Connected:</strong> {{ user.userprofile.lichess_username }}</p>
                </div>
            {% else %}
                <div class="status-indicator not-connected lichess-status">
                    <p><strong>⚠️ Lichess Not Connected</strong></p>
                    <p>Connect your Lichess account to start analyzing your games.</p>
                </div>
            {% endif %}

            <!-- Chess.com Status -->
            {% if user.userprofile.chess_com_username %}
                <div class="status-indicator connected chess-com-status">
                    <p><strong>✅ Chess.com Connected:</strong> {{ user.userprofile.chess_com_username }}</p>
                </div>
            {% else %}
                <div class="status-indicator not-connected chess-com-status">
                    <p><strong>⚠️ Chess.com Not Connected</strong></p>
                    <a href="{% url 'analysis:chess_com_connect' %}" class="chess-com-connect-btn">Connect Chess.com</a>
                </div>
            {% endif %}
        </div>

        <div class="section">
            <h3>Generate Reports</h3>
            <div class="generate-buttons-grid">
                <a href="{% url 'analysis:lichess_login' %}" class="generate-report-card lichess-card">
                    <div class="report-button-content">
                        <img src="{% static 'images/lichess_logo.svg' %}" alt="Lichess" class="report-logo">
                        <span class="report-label">Lichess</span>
                    </div>
                </a>

                {% if user.userprofile.chess_com_username %}
                <a href="{% url 'analysis:chess_com_analysis' user.userprofile.chess_com_username %}" class="generate-report-card chess-com-card">
                    <div class="report-button-content">
                        <img src="{% static 'images/chess_com_logo.png' %}" alt="Chess.com" class="report-logo">
                        <span class="report-label">Chess.com</span>
                    </div>
                </a>
                {% endif %}
            </div>
        </div>

        <div class="section">
            <h3>Daily Puzzle</h3>
            <div class="daily-puzzle-card">
                <div id="daily-puzzle-container"></div>
            </div>
        </div>
    </div>

    {% if reports %}
        <div class="section">
            <div class="reports-header-with-button">
                <h3>Recent Reports</h3>
                <a href="{% url 'analysis:user_reports' %}" class="btn btn-secondary view-all-btn">View All Reports</a>
            </div>
            <p>Your latest analysis reports:</p>

            {% for report in reports %}
            <a href="{% url 'analysis:generate_report' report.username report.game_dataset.id %}" class="report-card">
                <div class="report-stats-inline">
                    <div>
                        <strong>{{ report.username }}</strong>
                        <span class="report-card-platform">{{ report.platform }}</span>
                    </div>
                    <div>
                        <strong>{{ report.total_games }} Games</strong>
                    </div>
                    <div>
                        {{ report.created_at|date:"M j, Y" }}
                    </div>
                </div>
            </a>
            {% endfor %}

        </div>
    {% elif user.userprofile.lichess_username %}
        <div class="section">
            <h3>Ready to Start!</h3>
            <div class="empty-state">
                <p>Your Lichess account is connected. Click the button above to generate your first analysis report!</p>
            </div>
        </div>
    {% endif %}
{% else %}
    <div class="section">
        <h3>Get Started</h3>
        <p>Create an account or login to start analyzing your chess games!</p>
        <a href="/auth/login/" class="btn">Login</a>
        <a href="/auth/signup/" class="btn btn-secondary">Sign Up</a>
    </div>

    <div class="section">
        <h3>Daily Puzzle</h3>
        <p>Try today's puzzle from Chess.com:</p>
        <div class="daily-puzzle-card">
            <div id="daily-puzzle-container"></div>
        </div>
    </div>

{% endif %}

<h3>How it works:</h3>
<ol>
    <li>Create an account and connect your Lichess account</li>
    <li>We'll fetch your recent games (up to 5,000)</li>
    <li>Our analysis engine will process your games with Stockfish</li>
    <li>Get a comprehensive report with insights and recommendations</li>
</ol>

{% endblock %}
